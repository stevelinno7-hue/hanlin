(function (global) {
  'use strict';
  function init() {
    const G = global.RigorousGenerator || (window.global && window.global.RigorousGenerator);
    if (!G || !G.registerTemplate) { setTimeout(init, 100); return; }
    const { pick, shuffle } = G.utils;

    const db = [
     // ==========================================
        // 3. 物理 (Physics)
        // ==========================================
        // [國八] 力學與測量
        { s:"物理", t:["國八","測量"], q: "國際單位制(SI)長度單位", a: "公尺 (m)" },
        { s:"物理", t:["國八","測量"], q: "國際單位制(SI)質量單位", a: "公斤 (kg)" },
        { s:"物理", t:["國八","測量"], q: "密度的定義", a: "質量除以體積 (D=M/V)" },
        { s:"物理", t:["國八","力學"], q: "力的單位(SI)", a: "牛頓 (N)" },
        { s:"物理", t:["國八","力學"], q: "虎克定律", a: "彈簧伸長量與受力成正比" },
        { s:"物理", t:["國八","力學"], q: "摩擦力的方向", a: "與運動方向相反" },
        { s:"物理", t:["國八","力學"], q: "阿基米德原理", a: "浮力等於排開液重" },
        { s:"物理", t:["國八","力學"], q: "壓力的定義", a: "單位面積所受的力 (P=F/A)" },

        // [國八] 熱、波、光
        { s:"物理", t:["國八","熱"], q: "溫度的微觀意義", a: "分子的平均動能" },
        { s:"物理", t:["國八","熱"], q: "比熱大的物質", a: "難熱難冷" },
        { s:"物理", t:["國八","熱"], q: "熱傳導", a: "固體的主要傳熱方式" },
        { s:"物理", t:["國八","熱"], q: "熱對流", a: "流體的主要傳熱方式" },
        { s:"物理", t:["國八","熱"], q: "熱輻射", a: "不需介質的傳熱方式" },
        { s:"物理", t:["國八","波動"], q: "聲波屬於", a: "縱波 (力學波)" },
        { s:"物理", t:["國八","波動"], q: "光波屬於", a: "橫波 (電磁波)" },
        { s:"物理", t:["國八","波動"], q: "聲音的三要素", a: "響度、音調、音色" },
        { s:"物理", t:["國八","波動"], q: "音調決定於", a: "頻率" },
        { s:"物理", t:["國八","波動"], q: "響度決定於", a: "振幅" },
        { s:"物理", t:["國八","光"], q: "光的三原色", a: "紅、綠、藍" },
        { s:"物理", t:["國八","光"], q: "平面鏡成像性質", a: "正立、相等、虛像" },
        { s:"物理", t:["國八","光"], q: "凸透鏡成像", a: "可聚光，可成實像或虛像" },
        { s:"物理", t:["國八","光"], q: "近視眼矯正", a: "凹透鏡" },

        // [國九] 運動與電磁
        { s:"物理", t:["國九","運動"], q: "位移", a: "起點到終點的直線距離與方向" },
        { s:"物理", t:["國九","運動"], q: "速度", a: "位移除以時間 (具方向性)" },
        { s:"物理", t:["國九","運動"], q: "加速度", a: "單位時間內速度的變化量" },
        { s:"物理", t:["國九","運動"], q: "牛頓第一運動定律", a: "慣性定律" },
        { s:"物理", t:["國九","運動"], q: "牛頓第二運動定律", a: "F = ma" },
        { s:"物理", t:["國九","運動"], q: "牛頓第三運動定律", a: "作用力與反作用力" },
        { s:"物理", t:["國九","能量"], q: "動能公式", a: "1/2 mv²" },
        { s:"物理", t:["國九","能量"], q: "重力位能公式", a: "mgh" },
        { s:"物理", t:["國九","能量"], q: "功率的定義", a: "單位時間內所作的功" },
        { s:"物理", t:["國九","電學"], q: "歐姆定律", a: "V = IR" },
        { s:"物理", t:["國九","電學"], q: "串聯電路", a: "電流相同，電壓相加" },
        { s:"物理", t:["國九","電學"], q: "並聯電路", a: "電壓相同，電流相加" },
        { s:"物理", t:["國九","電學"], q: "伏特計連接方式", a: "並聯" },
        { s:"物理", t:["國九","電學"], q: "安培計連接方式", a: "串聯" },
        { s:"物理", t:["國九","磁學"], q: "安培右手定則", a: "判斷電流產生的磁場方向" },
        { s:"物理", t:["國九","磁學"], q: "法拉第定律", a: "磁場變化產生感應電流" },

        // [高中] 進階物理
        { s:"物理", t:["高一","運動"], q: "斜向拋射", a: "水平等速，鉛直等加" },
        { s:"物理", t:["高一","力學"], q: "動量守恆條件", a: "系統不受外力" },
        { s:"物理", t:["高一","引力"], q: "萬有引力定律", a: "F = GMm/r²" },
        { s:"物理", t:["高一","引力"], q: "克卜勒第一定律", a: "行星軌道為橢圓" },
        { s:"物理", t:["高二","光學"], q: "干涉現象證明光具有", a: "波動性" },
        { s:"物理", t:["高二","近代"], q: "光電效應證明光具有", a: "粒子性" },
        { s:"物理", t:["高二","近代"], q: "波粒二象性", a: "光與物質同時具有波動與粒子性質" },

    ];

    G.registerTemplate('physics_core', (ctx) => {
      const pool = (ctx && ctx.tags) ? db.filter(item => ctx.tags.includes(item.t[0])) : db;
      const base = pick(pool);
      const wrong = shuffle(db.filter(x => x.a !== base.a)).slice(0, 3).map(x => x.a);
      const opts = shuffle([base.a, ...wrong]);
      return {
        question: `【物理｜${base.t[1]}】${base.q}？`,
        options: opts, answer: opts.indexOf(base.a),
        concept: base.t[1]
      };
    }, ["physics", "物理", "自然"]);
  }
  init();
})(this);
